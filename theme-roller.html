<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>CalendarJS Theme Roller</title>

		<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
		<link rel='stylesheet' href="calendar.css" type='text/css'>
		<style id='custom-styles'></style>
		
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-brand" href="javascript:void(0);">CalendarJS Theme Roller</a>
				</div>
			</div>
		</nav>

		<div class="container">
			<div class="row">
				<div class="col-lg-6">
					<h3>Example Calendar</h3>
					<hr>
					<div id="cal"></div>
				</div>
				<div class="col-lg-6">
					<h3>Style Settings</h3>
					<hr>
					
					<div class="panel-group" id="accordion">
						
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class='row'>
									<div class='col-xs-6'>
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse1" style='color: black; text-decoration: none;'>
											<h4 class="panel-title" style="line-height: 2em; text-shadow: 1px 1px 0px rgba(252, 252, 252, 1);">All Colors</h4>
										</a>
									</div>
									<div class='col-xs-6'>
										<div class="input-group input-group-sm">
											<span class="input-group-addon"><span class='glyphicon glyphicon-pencil'></span></span>
											<input type="text" class="form-control" id='all-color' placeholder="All Colors">
										</div>
									</div>
								</div>
							</div>
							<div id="collapse1" class="panel-collapse collapse">
								<div class="panel-body">
									<div class="form-group">
										<label for="master-spin">Spin All Colors:</label>
										<input type="range" id="master-spin" name="master-spin" value=0 min="-360" max="360">
									</div>
									<div class="form-group">
										<label for="master-saturate">Saturate All Colors:</label>
										<input type="range" id="master-saturate" name="master-saturate" value=0 min="-100" max="100">
									</div>
									<div class="form-group">
										<label for="master-brightness">All Colors Brightness:</label>
										<input type="range" id="master-brightness" name="master-brightness" value=0 min="-100" max="100">
									</div>
									<button type="button" class="btn btn-primary btn-block" id='reset-all'>Reset All</button> 
								</div>
							</div>
						</div>
						
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class='row'>
									<div class='col-xs-6'>
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse2" style='color: black; text-decoration: none;'>
											<h4 class="panel-title" style="line-height: 2em; text-shadow: 1px 1px 0px rgba(252, 252, 252, 1);">Event Background Colors</h4>
										</a>
									</div>
									<div class='col-xs-6'>
										<div class="input-group input-group-sm">
											<span class="input-group-addon"><span class='glyphicon glyphicon-pencil'></span></span>
											<input type="text" class="form-control" id='--cal-evt-color' placeholder="Event Background Colors">
										</div>
									</div>
								</div>
							</div>
							<div id="collapse2" class="panel-collapse collapse">
								<div class="panel-body">
									<div class="form-group">
										<label for="--cal-evt-color-spin">Spin Event Background Color:</label>
										<input type="range" id="--cal-evt-color-spin" name="--cal-evt-color-spin" value=0 min="-360" max="360">
									</div>
									<div class="form-group">
										<label for="--cal-evt-color-saturate">Saturate Event Background Color:</label>
										<input type="range" id="--cal-evt-color-saturate" name="--cal-evt-color-saturate" value=0 min="-100" max="100">
									</div>
									<div class="form-group">
										<label for="--cal-evt-color-brightness">Event Background Color Brightness:</label>
										<input type="range" id="--cal-evt-color-brightness" name="--cal-evt-color-brightness" value=0 min="-100" max="100">
									</div>
									<button type="button" class="btn btn-primary btn-block" id='--cal-evt-color-reset'>Reset Event Background Color</button> 
								</div>
							</div>
						</div>
						
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class='row'>
									<div class='col-xs-6'>
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse3" style='color: black; text-decoration: none;'>
											<h4 class="panel-title" style="line-height: 2em; text-shadow: 1px 1px 0px rgba(252, 252, 252, 1);">Day Background Colors</h4>
										</a>
									</div>
									<div class='col-xs-6'>
										<div class="input-group input-group-sm">
											<span class="input-group-addon"><span class='glyphicon glyphicon-pencil'></span></span>
											<input type="text" class="form-control" id='--cal-light-color' placeholder="Day Background Colors">
										</div>
									</div>
								</div>
							</div>
							<div id="collapse3" class="panel-collapse collapse">
								<div class="panel-body">
									<div class="form-group">
										<label for="--cal-light-color-spin">Spin Day Background Colors:</label>
										<input type="range" id="--cal-light-color-spin" name="--cal-light-color-spin" value=0 min="-360" max="360">
									</div>
									<div class="form-group">
										<label for="--cal-light-color-saturate">Saturate Day Background Colors:</label>
										<input type="range" id="--cal-light-color-saturate" name="--cal-light-color-saturate" value=0 min="-100" max="100">
									</div>
									<div class="form-group">
										<label for="--cal-light-color-brightness">Day Background Color Brightness:</label>
										<input type="range" id="--cal-light-color-brightness" name="--cal-light-color-brightness" value=0 min="-100" max="100">
									</div>
									<button type="button" class="btn btn-primary btn-block" id='--cal-light-color-reset'>Reset Day Background Colors</button> 
								</div>
							</div>
						</div>
						
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class='row'>
									<div class='col-xs-6'>
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse4" style='color: black; text-decoration: none;'>
											<h4 class="panel-title" style="line-height: 2em; text-shadow: 1px 1px 0px rgba(252, 252, 252, 1);">Non-day & Button BG Colors</h4>
										</a>
									</div>
									<div class='col-xs-6'>
										<div class="input-group input-group-sm">
											<span class="input-group-addon"><span class='glyphicon glyphicon-pencil'></span></span>
											<input type="text" class="form-control" id='--cal-med-light-color' placeholder="Non-day & Button BG Colors">
										</div>
									</div>
								</div>
							</div>
							<div id="collapse4" class="panel-collapse collapse">
								<div class="panel-body">
									<div class="form-group">
										<label for="--cal-med-light-color-spin">Spin Non-day & Button BG Colors:</label>
										<input type="range" id="--cal-med-light-color-spin" name="--cal-med-light-color-spin" value=0 min="-360" max="360">
									</div>
									<div class="form-group">
										<label for="--cal-med-light-color-saturate">Saturate Non-day & Button BG Colors:</label>
										<input type="range" id="--cal-med-light-color-saturate" name="--cal-med-light-color-saturate" value=0 min="-100" max="100">
									</div>
									<div class="form-group">
										<label for="--cal-med-light-color-brightness">Non-day & Button BG Color Brightness:</label>
										<input type="range" id="--cal-med-light-color-brightness" name="--cal-med-light-color-brightness" value=0 min="-100" max="100">
									</div>
									<button type="button" class="btn btn-primary btn-block" id='--cal-med-light-color-reset'>Reset Non-day & Button BG Colors</button> 
								</div>
							</div>
						</div>
						
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class='row'>
									<div class='col-xs-6'>
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse5" style='color: black; text-decoration: none;'>
											<h4 class="panel-title" style="line-height: 2em; text-shadow: 1px 1px 0px rgba(252, 252, 252, 1);">Border Color</h4>
										</a>
									</div>
									<div class='col-xs-6'>
										<div class="input-group input-group-sm">
											<span class="input-group-addon"><span class='glyphicon glyphicon-pencil'></span></span>
											<input type="text" class="form-control" id='--cal-med-dark-color' placeholder="Border Color">
										</div>
									</div>
								</div>
							</div>
							<div id="collapse5" class="panel-collapse collapse">
								<div class="panel-body">
									<div class="form-group">
										<label for="--cal-med-dark-color-spin">Spin Border Color:</label>
										<input type="range" id="--cal-med-dark-color-spin" name="--cal-med-dark-color-spin" value=0 min="-360" max="360">
									</div>
									<div class="form-group">
										<label for="--cal-med-dark-color-saturate">Saturate Border Color:</label>
										<input type="range" id="--cal-med-dark-color-saturate" name="--cal-med-dark-color-saturate" value=0 min="-100" max="100">
									</div>
									<div class="form-group">
										<label for="--cal-med-dark-color-brightness">Border Color Brightness:</label>
										<input type="range" id="--cal-med-dark-color-brightness" name="--cal-med-dark-color-brightness" value=0 min="-100" max="100">
									</div>
									<button type="button" class="btn btn-primary btn-block" id='--cal-med-dark-color-reset'>Reset Border Color</button> 
								</div>
							</div>
						</div>
						
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class='row'>
									<div class='col-xs-6'>
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse6" style='color: black; text-decoration: none;'>
											<h4 class="panel-title" style="line-height: 2em; text-shadow: 1px 1px 0px rgba(252, 252, 252, 1);">Text Colors</h4>
										</a>
									</div>
									<div class='col-xs-6'>
										<div class="input-group input-group-sm">
											<span class="input-group-addon"><span class='glyphicon glyphicon-pencil'></span></span>
											<input type="text" class="form-control" id='--cal-dark-color' placeholder="Text Colors">
										</div>
									</div>
								</div>
							</div>
							<div id="collapse6" class="panel-collapse collapse">
								<div class="panel-body">
									<div class="form-group">
										<label for="--cal-dark-color-spin">Spin Text Colors:</label>
										<input type="range" id="--cal-dark-color-spin" name="--cal-dark-color-spin" value=0 min="-360" max="360">
									</div>
									<div class="form-group">
										<label for="--cal-dark-color-saturate">Saturate Text Colors:</label>
										<input type="range" id="--cal-dark-color-saturate" name="--cal-dark-color-saturate" value=0 min="-100" max="100">
									</div>
									<div class="form-group">
										<label for="--cal-dark-color-brightness">Text Color Brightness:</label>
										<input type="range" id="--cal-dark-color-brightness" name="--cal-dark-color-brightness" value=0 min="-100" max="100">
									</div>
									<button type="button" class="btn btn-primary btn-block" id='--cal-dark-color-reset'>Reset Text Colors</button> 
								</div>
							</div>
						</div>
						
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class='row'>
									<div class='col-xs-6'>
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse7" style='color: black; text-decoration: none;'>
											<h4 class="panel-title" style="line-height: 2em; text-shadow: 1px 1px 0px rgba(252, 252, 252, 1);">Event Text Color</h4>
										</a>
									</div>
									<div class='col-xs-6'>
										<div class="input-group input-group-sm">
											<span class="input-group-addon"><span class='glyphicon glyphicon-pencil'></span></span>
											<input type="text" class="form-control" id='--cal-black-color' placeholder="Event Text Color">
										</div>
									</div>
								</div>
							</div>
							<div id="collapse7" class="panel-collapse collapse">
								<div class="panel-body">
									<div class="form-group">
										<label for="--cal-black-color-spin">Spin Event Text Color:</label>
										<input type="range" id="--cal-black-color-spin" name="--cal-black-color-spin" value=0 min="-360" max="360">
									</div>
									<div class="form-group">
										<label for="--cal-black-color-saturate">Saturate Event Text Color:</label>
										<input type="range" id="--cal-black-color-saturate" name="--cal-black-color-saturate" value=0 min="-100" max="100">
									</div>
									<div class="form-group">
										<label for="--cal-black-color-brightness">Black Color Brightness:</label>
										<input type="range" id="--cal-black-color-brightness" name="--cal-black-color-brightness" value=0 min="-100" max="100">
									</div>
									<button type="button" class="btn btn-primary btn-block" id='--cal-black-color-reset'>Reset Event Text Color</button> 
								</div>
							</div>
						</div>
						
					</div>				
					
					<div class="form-group">
						<label for="styles">CSS: </label>
						<textarea class="form-control" rows="5" id="styles"></textarea>
					</div> 
				</div>
			</div>
		</div>

		<script src="//code.jquery.com/jquery-2.2.4.min.js"></script>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src='calendar.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.4.1/tinycolor.js'></script>
		<script>
			
			var orig_colors = {
				'--cal-evt-color': 'rgba(0, 153, 153, .4)',
				'--cal-light-color': 'rgba(184, 230, 255, 1)',
				'--cal-med-light-color': 'rgba(159, 221, 255, 1)',
				'--cal-med-dark-color': 'rgba(127, 210, 255, 1)',
				'--cal-dark-color': 'rgba(44, 126, 170, 1)',
				'--cal-black-color': 'rgba(33, 33, 33, 1)'
			};
			
			var average_color = getAverageColor(orig_colors);
			var color_differences = {};
			Object.keys(orig_colors).forEach(k=>{
				color_differences[k] = getColorDifference(average_color, orig_colors[k]);
			});
			
			var colors = {};
			Object.keys(orig_colors).forEach(k=>{
				colors[k] = orig_colors[k];
			});
			
			$("#reset-all").click(()=>{
				var functs = ['spin', 'saturate', 'brightness'];
				Object.keys(orig_colors).forEach(k=>{
					colors[k] = orig_colors[k];
					$("#"+k).val(colors[k]);
					functs.forEach(f=>{
						$("#"+k+"-"+f).val(0);
					});
					setColor(k);
				});
				functs.forEach(f=>{
					$("#master-"+f).val(0);
				});
				setColors();
			});
			
			$('#master-spin').on('input', function(e){
				Object.keys(colors).forEach(k=>{
					spinColor(k, this.value);
				});
				setColors();
			});
			$('#master-saturate').on('input', function(e){
				Object.keys(colors).forEach(k=>{
					saturateColor(k, this.value);
				});
				setColors();
			});
			$('#master-brightness').on('input', function(e){
				Object.keys(colors).forEach(k=>{
					brightenColor(k, this.value);
				});
				setColors();
			});
			
			Object.keys(colors).forEach(key=>{
				$("#"+key).change(function(e){
					var color = tinycolor(this.value);
					if(!color.isValid()) color = tinycolor(colors[key]);
					colors[key] = color.toRgbString();
					setColor(key);
					setColors();
				});
				$("#"+key+"-spin").on('input', function(e){
					spinColor(key, this.value);
					setColor(key);
					setColors();
				});
				$("#"+key+"-saturate").on('input', function(e){
					saturateColor(key, this.value);
					setColor(key);
					setColors();
				});
				$("#"+key+"-brightness").on('input', function(e){
					brightenColor(key, this.value);
					setColor(key);
					setColors();
				});
				$("#"+key+"-reset").on('click', function(e){
					var functs = ['spin', 'saturate', 'brightness'];
					colors[key] = orig_colors[key];
					$("#"+key).val(colors[key]);
					functs.forEach(f=>{
						$("#"+key+"-"+f).val(0);
					});
					setColor(key);
					setColors();
				});
			});
			
			$("#all-color").change(function(e){
				var color = tinycolor(this.value);
				if(!color.isValid()){
					$("#all-color").val(average_color);
					return;
				}
				average_color = color.toRgbString();
				this.value = average_color;
				Object.keys(color_differences).forEach(k=>{
					colors[k] = getColorRelativeTo(average_color, color_differences[k]);
				});
				
				$("#all-color").val(average_color);
				$("#all-color").parent().parent().parent().parent().css('background-color', average_color);
				
				Object.keys(colors).forEach(setColor);
				setColors();
			});
			
			$("#all-color").val(average_color);
			$("#all-color").parent().parent().parent().parent().css('background-color', average_color);
			
			Object.keys(orig_colors).forEach(setColor);
			drawCalendar();
			setColors();
			
			function setColor(key){
				$("#"+key).val(colors[key]);
				$("#"+key).parent().parent().parent().parent().css('background-color', colors[key]);
			}
			
			function saturateColor(key, saturation){
				saturation = +saturation;
				var funct = saturation > 0 ? 'saturate' : 'desaturate';
				var level = Math.abs(saturation);
				colors[key] = tinycolor(colors[key])[funct](level).toRgbString();
				setColor(key);
			}
			
			function brightenColor(key, brightness){
				brightness = +brightness;
				var funct = brightness > 0 ? 'brighten' : 'darken';
				var level = Math.abs(brightness);
				colors[key] = tinycolor(colors[key])[funct](level).toRgbString();
				setColor(key);
			}
			
			function spinColor(key, spin){
				colors[key] = tinycolor(colors[key]).spin(+spin).toRgbString();
				setColor(key);
			}
			
			function setColors(){
				var style = document.getElementById('custom-styles');
				var css = `
				:root {
					--cal-light-color: ${colors['--cal-light-color']};
					--cal-med-light-color: ${colors['--cal-med-light-color']};
					--cal-med-dark-color: ${colors['--cal-med-dark-color']};
					--cal-dark-color: ${colors['--cal-dark-color']};
					--cal-black-color: ${colors['--cal-black-color']};
					--cal-evt-color: ${colors['--cal-evt-color']};
				}

				.cjs-dayCol{
					background-color: var(--cal-light-color);
				}

				.cjs-dayHeader{
					background-color: var(--cal-light-color);
					color: var(--cal-dark-color);
				}

				.cjs-active{
					background: var(--cal-med-dark-color);
					border-color: var(--cal-light-color);
				}

				.cjs-blankday{
					background-color: var(--cal-med-light-color);
				}

				.cjs-lastLink{
					background: var(--cal-med-light-color);
					color: var(--cal-dark-color);
					border: 1px solid var(--cal-med-dark-color);
				}

				.cjs-nextLink{
					background: var(--cal-med-light-color);
					color: var(--cal-dark-color);
					border: 1px solid var(--cal-med-dark-color);
				}

				.cjs-calDay:hover{
					background: var(--cal-med-light-color);
				}

				.cjs-right{
					border-right: 1px solid var(--cal-med-dark-color);
				}

				.cjs-top{
					border-top: 1px solid var(--cal-med-dark-color);
				}

				.cjs-left{
					border-left: 1px solid var(--cal-med-dark-color);
				}

				.cjs-bottom{
					border-bottom: 1px solid var(--cal-med-dark-color);
				}

				.cjs-otherEvents{
					background: var(--cal-med-dark-color);
					color: var(--cal-black-color);
				}

				.cjs-calHeader{
					color: var(--cal-dark-color);
				}

				.cjs-dayContent{
					color: var(--cal-dark-color);
				}

				.cjs-calEvent{
					background: var(--cal-evt-color);
					color: var(--cal-black-color);
				}`;
				var styles = document.createTextNode(css);
				while (style.lastChild) style.removeChild(style.lastChild);
				style.appendChild(styles);
				$("#styles").val(css.replace(/\s\s+/g, ' '));
			}
			
			function drawCalendar(){
				var cal = null;
				var ele = document.getElementById('cal');			
				var opts = {
					events: [{date: new Date(2016, 8, 11), desc:"My Birthday!"}],
					abbrDay: true,
					abbrMonth:true, 
					month: 9, 
					year: 2016,
					onDayClick: function(date){cal.selectDate(date);},
					onEventClick: function(event){alert(event.desc);}
				};
				cal = new calendar(ele, opts);
			}
			
			function getAverageColor(col_obj){
				var rgb = {};
				Object.keys(col_obj).forEach(kcolor=>{
					var color = col_obj[kcolor];
					var c = tinycolor(color).toRgb();
					Object.keys(c).forEach(k=>{
						if(rgb[k]){
							rgb[k] += c[k];
							rgb[k] = rgb[k]/2;
						}else{
							rgb[k] = c[k];
						}
					});
				});
				return `rgb(${Math.round(rgb.r)},${Math.round(rgb.g)},${Math.round(rgb.b)})`;
			}
			
			function getColorDifference(color1, color2){
				color1 = tinycolor(color1).toRgb();
				color2 = tinycolor(color2).toRgb();
				return {
					r: color1.r - color2.r,
					g: color1.g - color2.g,
					b: color1.b - color2.b
				};
			}
			
			function getColorRelativeTo(color, difference){
				color = tinycolor(color).toRgb();
				color.r -= difference.r;
				color.g -= difference.g;
				color.b -= difference.b;
				return `rgb(${Math.round(color.r)},${Math.round(color.g)},${Math.round(color.b)})`;
			}
			
			console.log('average_color', average_color);
			console.log('event_color', orig_colors['--cal-light-color']);
			var diff = getColorDifference(average_color, orig_colors['--cal-light-color']);
			console.log('color_diff', diff);
			
			console.log('relative_to', getColorRelativeTo(average_color, diff));
		</script>
	</body>
</html>